@model XProductsWeb.Models.ProductViewModel
@{
    ViewBag.Title = "Index";
}

<h2>Products</h2>

<div class="row">
    <div class="col-xs-12">
        @using (Html.BeginForm("Search", "Product", FormMethod.Post, new { @class = "form-inline", role = "form" }))
        {
            <div class="form-group">
                @Html.DropDownListFor(m => m.SelectedCategory, Model.CategoryItems, new { @id = "category", @name = "categoryId", @class = "form-control" })
            </div>
            <div class="form-group">
                @Html.TextBoxFor(m => m.Search, new { @id = "searchText", @name = "search", @class = "form-control", @placeholder = "Search" })
            </div>
            @*<button type="submit" class="btn btn-default">Search</button>*@
        }
    </div>
    <br />
    <div class="col-xs-12 clearfix" id="products">
        @*<ul class="list-group">
            @foreach (var item in Model.Products)
            {
                <li class="list-group-item clearfix">
                    <div class="pull-right">
                        @Html.ActionLink("Edit", "Edit", new { id = item.Id }, new { @class = "btn btn-default" })
                        @Html.ActionLink("Details", "Details", new { id = item.Id }, new { @class = "btn btn-default" })
                    </div>
                    <h3 class="list-group-item-heading">
                        @Html.DisplayFor(modelItem => item.Name) - @Html.DisplayFor(modelItem => item.Price) €
                    </h3>
                    <div class="list-group-item-text">
                            <h4>Description: @Html.DisplayFor(modelItem => item.Description)</h4>
                            <h5>Category: @Html.DisplayFor(modelItem => item.Category.Wording)</h5>
                            <h6>@Html.DisplayFor(modelItem => item.Stock) items left</h6>                      
                    </div>
                </li>
            }
        </ul>*@
        @Html.Partial("PartialProduct", Model)
        @Html.ActionLink("Create New", "Create", null, new { @class = "btn btn-info pull-right" })
    </div>
</div>

@section Scripts {
<script type="text/javascript">

    $(document).ready(function () {

        function loadProducts() {
            var categoryId = $("#category").val();
            var searchText = $("#searchText").val();
            $("#products").load('@(Url.Action("GetProducts", "Product", null, Request.Url.Scheme))?categoryId=' + categoryId + '&searchText=' + searchText);
        }

        $("#category").change(function () {
            loadProducts();
        });
        $("#searchText").keyup(function () {
            loadProducts();
        });
    });

</script>
    }